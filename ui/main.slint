import { HorizontalBox, VerticalBox, Button, StandardListView, StandardTableView, LineEdit, ListView } from "std-widgets.slint";
import { MagicListView, MagicListViewItem, Icons, FilledButton } from "@vivi/magic.slint";
import { LoadingDialog } from "loading.slint";

export { LoadingDialog, Icons }

export component AppWindow inherits Window {
    min-width: 100px;
    min-height: 100px;
    max-width: 10000px;
    max-height: 10000px;
    title: @tr("BletchMAME 3.0 prototype");
    callback find_mame_clicked();
    in property <bool> is_running;
    in property <bool> has_info_db;
    in property <int> history-length;
    in property <int> history-position;
    in-out property <length> collections-list-view-preferred-height <=> collections-list-view.preferred-height;
    in-out property <string> items_search_text;
    callback collections-view-selected(int);
    callback items-search_text-changed(string);
    callback items-sort-ascending(int);
    callback items-sort-descending(int);
    callback items-row-pointer-event(int, PointerEvent, Point);
    callback history-advance-clicked(int);
    in property <[MagicListViewItem]> collections-model;
    in property <[[StandardListViewItem]]> items-model;
    public function collections-view-select(index: int) {
        collections-list-view.current_index = index;
    }
    VerticalBox {
        alignment: center;
        Text {
            text: @tr("BletchMAME needs a working MAME to function");
            font-size: 24px;
            wrap: word-wrap;
        }

        Button {
            text: @tr("Find MAME...");
            clicked => {
                root.find_mame_clicked();
            }
        }

        width: 300px;
        visible: !has_info_db;
    }

    HorizontalBox {
        visible: has_info_db && !is_running;
        collections-list-view := MagicListView {
            width: 250px;
            preferred-height: 100%;
            model: collections-model;
            selected(index) => {
                collections-view-selected(index)
            }
        }

        VerticalBox {
            HorizontalBox {
                FilledButton {
                    icon: Icons.arrow_back;
                    enabled: history-position + 1 < history-length;
                    clicked => {
                        history-advance-clicked(+1)
                    }
                }

                FilledButton {
                    icon: Icons.book;
                    enabled: false;
                }

                FilledButton {
                    icon: Icons.arrow_forward;
                    enabled: history-position > 0;
                    clicked => {
                        history-advance-clicked(-1)
                    }
                }

                LineEdit {
                    text: items_search_text;
                    edited(text) => {
                        items-search-text-changed(text)
                    }
                }
            }

            StandardTableView {
                columns: [
                    { title: @tr("Name") },
                    { title: @tr("Source File") },
                    { title: @tr("Description") },
                    { title: @tr("Year") },
                    { title: @tr("Manufacturer") }
                ];
                rows: items_model;
                preferred-width: 100%;
                preferred-height: 100%;
                sort-ascending(index) => {
                    items-sort-ascending(index)
                }
                sort-descending(index) => {
                    items-sort-descending(index)
                }
                row-pointer-event(row, event, point) => {
                    items-row-pointer-event(row, event, point)
                }
            }
        }
    }
}
